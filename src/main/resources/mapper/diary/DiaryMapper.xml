<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jungwoo.project.memo.diary.DiaryMapper">

    <resultMap id="DiaryResultMap" type="Diary">
        <id property="diaryId" column="diary_id"/>
        <result property="userId" column="user_id"/>
        <result property="writtenDate" column="written_date"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="mood" column="mood"/>
        <result property="visibility" column="visibility"/>
        <result property="weather" column="weather"/>
        <result property="favorite" column="is_favorite"/>
        <result property="deleted" column="is_deleted"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 다이어리 단건 -->
    <select id="findById" resultMap="DiaryResultMap">
        SELECT * FROM diaries
        WHERE diary_id = #{diaryId}
          AND is_deleted = false
    </select>

    <!-- 사용자별 다이어리 목록 -->
    <select id="findByUser" resultMap="DiaryResultMap">
        SELECT * FROM diaries
        WHERE user_id = #{userId}
          AND is_deleted = false
        ORDER BY written_date DESC
    </select>

    <!-- 다이어리 생성 -->
    <insert id="insertDiary" useGeneratedKeys="true" keyProperty="diaryId">
        INSERT INTO diaries (
            user_id, written_date, title, content,
            mood, visibility, weather
        ) VALUES (
                     #{userId}, #{writtenDate}, #{title}, #{content},
                     #{mood}, #{visibility}, #{weather}
                 )
    </insert>

    <!-- 다이어리 수정 -->
    <update id="updateDiary">
        UPDATE diaries
        SET title = #{title},
            content = #{content},
            mood = #{mood},
            visibility = #{visibility},
            weather = #{weather}
        WHERE diary_id = #{diaryId}
    </update>

    <!-- 즐겨찾기 토글 -->
    <update id="toggleFavorite">
        UPDATE diaries
        SET is_favorite = #{isFavorite}
        WHERE diary_id = #{diaryId}
    </update>

    <!-- 소프트 삭제 -->
    <update id="softDelete">
        UPDATE diaries
        SET is_deleted = true
        WHERE diary_id = #{diaryId}
    </update>

</mapper>
